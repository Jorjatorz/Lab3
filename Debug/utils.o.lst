   1              		.cpu arm7tdmi
   2              		.fpu softvfp
   3              		.eabi_attribute 20, 1
   4              		.eabi_attribute 21, 1
   5              		.eabi_attribute 23, 3
   6              		.eabi_attribute 24, 1
   7              		.eabi_attribute 25, 1
   8              		.eabi_attribute 26, 1
   9              		.eabi_attribute 30, 6
  10              		.eabi_attribute 18, 4
  11              		.file	"utils.c"
  21              	.Ltext0:
  22              		.file 1 "../utils.c"
 1782              		.align	2
 1785              	delayLoopCount:
 1786 0000 90010000 		.word	400
 1787              		.global	__aeabi_idiv
 1788              		.text
 1789              		.align	2
 1790              		.global	Delay
 1792              	Delay:
 1793              	.LFB0:
   1:../utils.c    **** /*-------------------------------------------------------------------
   2:../utils.c    **** **
   3:../utils.c    **** **  Fichero:
   4:../utils.c    **** **    utils.c  10/6/2014
   5:../utils.c    **** **
   6:../utils.c    **** **    Estructura de Computadores
   7:../utils.c    **** **    Dpto. de Arquitectura de Computadores y Automática
   8:../utils.c    **** **    Facultad de Informática. Universidad Complutense de Madrid
   9:../utils.c    **** **
  10:../utils.c    **** **  Propósito:
  11:../utils.c    **** **    Contiene las implementaciones de funciones auxiliares
  12:../utils.c    **** **
  13:../utils.c    **** **  Notas de diseño:
  14:../utils.c    **** **    Equivale al fichero homónimo usado en Fundamentos de Computadores 
  15:../utils.c    **** **
  16:../utils.c    **** **-----------------------------------------------------------------*/
  17:../utils.c    **** 
  18:../utils.c    **** #include "utils.h"
  19:../utils.c    **** 
  20:../utils.c    **** #include "44b.h"
  21:../utils.c    **** #define MCLK 64000000
  22:../utils.c    **** 
  23:../utils.c    **** //--------------------------------SYSTEM---------------------------------//
  24:../utils.c    **** static int delayLoopCount=400;
  25:../utils.c    **** 
  26:../utils.c    **** void Delay(int time)
  27:../utils.c    **** // time=0: adjust the Delay function by WatchDog timer.//
  28:../utils.c    **** // time>0: the number of loop time//
  29:../utils.c    **** // 100us resolution.//
  30:../utils.c    **** {
 1794              		.loc 1 30 0
 1795              		.cfi_startproc
 1796              		@ Function supports interworking.
 1797              		@ args = 0, pretend = 0, frame = 16
 1798              		@ frame_needed = 1, uses_anonymous_args = 0
 1799 0000 0DC0A0E1 		mov	ip, sp
 1800              	.LCFI0:
 1801              		.cfi_def_cfa_register 12
 1802 0004 00D82DE9 		stmfd	sp!, {fp, ip, lr, pc}
 1803 0008 04B04CE2 		sub	fp, ip, #4
 1804              		.cfi_offset 14, -8
 1805              		.cfi_offset 13, -12
 1806              		.cfi_offset 11, -16
 1807              	.LCFI1:
 1808              		.cfi_def_cfa 11, 4
 1809 000c 10D04DE2 		sub	sp, sp, #16
 1810 0010 18000BE5 		str	r0, [fp, #-24]
  31:../utils.c    **** 	int i,adjust=0;
 1811              		.loc 1 31 0
 1812 0014 0030A0E3 		mov	r3, #0
 1813 0018 14300BE5 		str	r3, [fp, #-20]
  32:../utils.c    **** 	if(time==0)
 1814              		.loc 1 32 0
 1815 001c 18301BE5 		ldr	r3, [fp, #-24]
 1816 0020 000053E3 		cmp	r3, #0
 1817 0024 2100001A 		bne	.L3
  33:../utils.c    **** 	{
  34:../utils.c    **** 		time=200;
 1818              		.loc 1 34 0
 1819 0028 C830A0E3 		mov	r3, #200
 1820 002c 18300BE5 		str	r3, [fp, #-24]
  35:../utils.c    **** 		adjust=1;
 1821              		.loc 1 35 0
 1822 0030 0130A0E3 		mov	r3, #1
 1823 0034 14300BE5 		str	r3, [fp, #-20]
  36:../utils.c    **** 		delayLoopCount=400;
 1824              		.loc 1 36 0
 1825 0038 D8309FE5 		ldr	r3, .L8
 1826 003c 192EA0E3 		mov	r2, #400
 1827 0040 002083E5 		str	r2, [r3, #0]
  37:../utils.c    **** 		rWTCON=((MCLK/1000000-1)<<8)|(2<<3);	// 1M/64,Watch-dog,nRESET,interrupt disable//
 1828              		.loc 1 37 0
 1829 0044 D0309FE5 		ldr	r3, .L8+4
 1830 0048 D0209FE5 		ldr	r2, .L8+8
 1831 004c 002083E5 		str	r2, [r3, #0]
  38:../utils.c    **** 		rWTDAT=0xffff;
 1832              		.loc 1 38 0
 1833 0050 CC309FE5 		ldr	r3, .L8+12
 1834 0054 CC209FE5 		ldr	r2, .L8+16
 1835 0058 002083E5 		str	r2, [r3, #0]
  39:../utils.c    **** 		rWTCNT=0xffff;
 1836              		.loc 1 39 0
 1837 005c C8309FE5 		ldr	r3, .L8+20
 1838 0060 C0209FE5 		ldr	r2, .L8+16
 1839 0064 002083E5 		str	r2, [r3, #0]
  40:../utils.c    **** 		rWTCON=((MCLK/1000000-1)<<8)|(2<<3)|(1<<5); // 1M/64,Watch-dog enable,nRESET,interrupt disable //
 1840              		.loc 1 40 0
 1841 0068 AC309FE5 		ldr	r3, .L8+4
 1842 006c BC209FE5 		ldr	r2, .L8+24
 1843 0070 002083E5 		str	r2, [r3, #0]
  41:../utils.c    **** 	}
  42:../utils.c    **** 	for(;time>0;time--)
 1844              		.loc 1 42 0
 1845 0074 0D0000EA 		b	.L3
 1846              	.L6:
  43:../utils.c    **** 		for(i=0;i<delayLoopCount;i++);
 1847              		.loc 1 43 0
 1848 0078 0030A0E3 		mov	r3, #0
 1849 007c 10300BE5 		str	r3, [fp, #-16]
 1850 0080 020000EA 		b	.L4
 1851              	.L5:
 1852              		.loc 1 43 0 is_stmt 0 discriminator 2
 1853 0084 10301BE5 		ldr	r3, [fp, #-16]
 1854 0088 013083E2 		add	r3, r3, #1
 1855 008c 10300BE5 		str	r3, [fp, #-16]
 1856              	.L4:
 1857              		.loc 1 43 0 discriminator 1
 1858 0090 80309FE5 		ldr	r3, .L8
 1859 0094 003093E5 		ldr	r3, [r3, #0]
 1860 0098 10201BE5 		ldr	r2, [fp, #-16]
 1861 009c 030052E1 		cmp	r2, r3
 1862 00a0 F7FFFFBA 		blt	.L5
  42:../utils.c    **** 	for(;time>0;time--)
 1863              		.loc 1 42 0 is_stmt 1
 1864 00a4 18301BE5 		ldr	r3, [fp, #-24]
 1865 00a8 013043E2 		sub	r3, r3, #1
 1866 00ac 18300BE5 		str	r3, [fp, #-24]
 1867              	.L3:
  42:../utils.c    **** 	for(;time>0;time--)
 1868              		.loc 1 42 0 is_stmt 0 discriminator 1
 1869 00b0 18301BE5 		ldr	r3, [fp, #-24]
 1870 00b4 000053E3 		cmp	r3, #0
 1871 00b8 EEFFFFCA 		bgt	.L6
  44:../utils.c    **** 	if(adjust==1)
 1872              		.loc 1 44 0 is_stmt 1
 1873 00bc 14301BE5 		ldr	r3, [fp, #-20]
 1874 00c0 010053E3 		cmp	r3, #1
 1875 00c4 1000001A 		bne	.L1
  45:../utils.c    **** 	{
  46:../utils.c    **** 		rWTCON=((MCLK/1000000-1)<<8)|(2<<3);
 1876              		.loc 1 46 0
 1877 00c8 4C309FE5 		ldr	r3, .L8+4
 1878 00cc 4C209FE5 		ldr	r2, .L8+8
 1879 00d0 002083E5 		str	r2, [r3, #0]
  47:../utils.c    **** 		i=0xffff-rWTCNT;   //  1count/16us?????????//
 1880              		.loc 1 47 0
 1881 00d4 50309FE5 		ldr	r3, .L8+20
 1882 00d8 003093E5 		ldr	r3, [r3, #0]
 1883 00dc FF3C63E2 		rsb	r3, r3, #65280
 1884 00e0 FF3083E2 		add	r3, r3, #255
 1885 00e4 10300BE5 		str	r3, [fp, #-16]
  48:../utils.c    **** 		delayLoopCount=8000000/(i*64);	//400*100/(i*64/200)   //
 1886              		.loc 1 48 0
 1887 00e8 10301BE5 		ldr	r3, [fp, #-16]
 1888 00ec 0333A0E1 		mov	r3, r3, asl #6
 1889 00f0 3C009FE5 		ldr	r0, .L8+28
 1890 00f4 0310A0E1 		mov	r1, r3
 1891 00f8 FEFFFFEB 		bl	__aeabi_idiv
 1892 00fc 0030A0E1 		mov	r3, r0
 1893 0100 0320A0E1 		mov	r2, r3
 1894 0104 0C309FE5 		ldr	r3, .L8
 1895 0108 002083E5 		str	r2, [r3, #0]
 1896              	.L1:
  49:../utils.c    **** 	}
  50:../utils.c    **** }
 1897              		.loc 1 50 0
 1898 010c 0CD04BE2 		sub	sp, fp, #12
 1899 0110 00689DE8 		ldmfd	sp, {fp, sp, lr}
 1900 0114 1EFF2FE1 		bx	lr
 1901              	.L9:
 1902              		.align	2
 1903              	.L8:
 1904 0118 00000000 		.word	delayLoopCount
 1905 011c 0000D301 		.word	30605312
 1906 0120 103F0000 		.word	16144
 1907 0124 0400D301 		.word	30605316
 1908 0128 FFFF0000 		.word	65535
 1909 012c 0800D301 		.word	30605320
 1910 0130 303F0000 		.word	16176
 1911 0134 00127A00 		.word	8000000
 1912              		.cfi_endproc
 1913              	.LFE0:
 1915              		.align	2
 1916              		.global	insertElementToQueue
 1918              	insertElementToQueue:
 1919              	.LFB1:
  51:../utils.c    **** 
  52:../utils.c    **** void insertElementToQueue(tQueue* queue, int element)
  53:../utils.c    **** {
 1920              		.loc 1 53 0
 1921              		.cfi_startproc
 1922              		@ Function supports interworking.
 1923              		@ args = 0, pretend = 0, frame = 16
 1924              		@ frame_needed = 1, uses_anonymous_args = 0
 1925 0138 0DC0A0E1 		mov	ip, sp
 1926              	.LCFI2:
 1927              		.cfi_def_cfa_register 12
 1928 013c 00D82DE9 		stmfd	sp!, {fp, ip, lr, pc}
 1929 0140 04B04CE2 		sub	fp, ip, #4
 1930              		.cfi_offset 14, -8
 1931              		.cfi_offset 13, -12
 1932              		.cfi_offset 11, -16
 1933              	.LCFI3:
 1934              		.cfi_def_cfa 11, 4
 1935 0144 10D04DE2 		sub	sp, sp, #16
 1936 0148 18000BE5 		str	r0, [fp, #-24]
 1937 014c 1C100BE5 		str	r1, [fp, #-28]
  54:../utils.c    **** 	if(queue->elements < 4)
 1938              		.loc 1 54 0
 1939 0150 18301BE5 		ldr	r3, [fp, #-24]
 1940 0154 B830D3E1 		ldrh	r3, [r3, #8]
 1941 0158 0338A0E1 		mov	r3, r3, asl #16
 1942 015c 4338A0E1 		mov	r3, r3, asr #16
 1943 0160 030053E3 		cmp	r3, #3
 1944 0164 160000CA 		bgt	.L11
  55:../utils.c    **** 	{
  56:../utils.c    **** 		queue->_queue[queue->elements] = element;
 1945              		.loc 1 56 0
 1946 0168 18301BE5 		ldr	r3, [fp, #-24]
 1947 016c B830D3E1 		ldrh	r3, [r3, #8]
 1948 0170 0338A0E1 		mov	r3, r3, asl #16
 1949 0174 4338A0E1 		mov	r3, r3, asr #16
 1950 0178 1C201BE5 		ldr	r2, [fp, #-28]
 1951 017c 0228A0E1 		mov	r2, r2, asl #16
 1952 0180 2228A0E1 		mov	r2, r2, lsr #16
 1953 0184 18101BE5 		ldr	r1, [fp, #-24]
 1954 0188 8330A0E1 		mov	r3, r3, asl #1
 1955 018c 033081E0 		add	r3, r1, r3
 1956 0190 B020C3E1 		strh	r2, [r3, #0]	@ movhi
  57:../utils.c    **** 		queue->elements = queue->elements + 1;
 1957              		.loc 1 57 0
 1958 0194 18301BE5 		ldr	r3, [fp, #-24]
 1959 0198 B830D3E1 		ldrh	r3, [r3, #8]
 1960 019c 0338A0E1 		mov	r3, r3, asl #16
 1961 01a0 2338A0E1 		mov	r3, r3, lsr #16
 1962 01a4 013083E2 		add	r3, r3, #1
 1963 01a8 0338A0E1 		mov	r3, r3, asl #16
 1964 01ac 2338A0E1 		mov	r3, r3, lsr #16
 1965 01b0 0338A0E1 		mov	r3, r3, asl #16
 1966 01b4 2328A0E1 		mov	r2, r3, lsr #16
 1967 01b8 18301BE5 		ldr	r3, [fp, #-24]
 1968 01bc B820C3E1 		strh	r2, [r3, #8]	@ movhi
 1969 01c0 180000EA 		b	.L10
 1970              	.L11:
 1971              	.LBB2:
  58:../utils.c    **** 	}
  59:../utils.c    **** 	else
  60:../utils.c    **** 	{
  61:../utils.c    **** 		//Mover la arrey para la izquierda e insertar el nuevo elemento
  62:../utils.c    **** 		int i;
  63:../utils.c    **** 		for(i = 0; i < 3; i++)
 1972              		.loc 1 63 0
 1973 01c4 0030A0E3 		mov	r3, #0
 1974 01c8 10300BE5 		str	r3, [fp, #-16]
 1975 01cc 0D0000EA 		b	.L13
 1976              	.L14:
  64:../utils.c    **** 		{
  65:../utils.c    **** 			queue->_queue[i] = queue->_queue[i + 1];
 1977              		.loc 1 65 0 discriminator 2
 1978 01d0 10301BE5 		ldr	r3, [fp, #-16]
 1979 01d4 013083E2 		add	r3, r3, #1
 1980 01d8 18201BE5 		ldr	r2, [fp, #-24]
 1981 01dc 8330A0E1 		mov	r3, r3, asl #1
 1982 01e0 033082E0 		add	r3, r2, r3
 1983 01e4 B020D3E1 		ldrh	r2, [r3, #0]
 1984 01e8 18101BE5 		ldr	r1, [fp, #-24]
 1985 01ec 10301BE5 		ldr	r3, [fp, #-16]
 1986 01f0 8330A0E1 		mov	r3, r3, asl #1
 1987 01f4 033081E0 		add	r3, r1, r3
 1988 01f8 B020C3E1 		strh	r2, [r3, #0]	@ movhi
  63:../utils.c    **** 		for(i = 0; i < 3; i++)
 1989              		.loc 1 63 0 discriminator 2
 1990 01fc 10301BE5 		ldr	r3, [fp, #-16]
 1991 0200 013083E2 		add	r3, r3, #1
 1992 0204 10300BE5 		str	r3, [fp, #-16]
 1993              	.L13:
  63:../utils.c    **** 		for(i = 0; i < 3; i++)
 1994              		.loc 1 63 0 is_stmt 0 discriminator 1
 1995 0208 10301BE5 		ldr	r3, [fp, #-16]
 1996 020c 020053E3 		cmp	r3, #2
 1997 0210 EEFFFFDA 		ble	.L14
  66:../utils.c    **** 		}
  67:../utils.c    **** 
  68:../utils.c    **** 		queue->_queue[3] = element;
 1998              		.loc 1 68 0 is_stmt 1
 1999 0214 1C301BE5 		ldr	r3, [fp, #-28]
 2000 0218 0338A0E1 		mov	r3, r3, asl #16
 2001 021c 2328A0E1 		mov	r2, r3, lsr #16
 2002 0220 18301BE5 		ldr	r3, [fp, #-24]
 2003 0224 B620C3E1 		strh	r2, [r3, #6]	@ movhi
 2004              	.L10:
 2005              	.LBE2:
  69:../utils.c    **** 	}
  70:../utils.c    **** }
 2006              		.loc 1 70 0
 2007 0228 0CD04BE2 		sub	sp, fp, #12
 2008 022c 00689DE8 		ldmfd	sp, {fp, sp, lr}
 2009 0230 1EFF2FE1 		bx	lr
 2010              		.cfi_endproc
 2011              	.LFE1:
 2013              	.Letext0:
DEFINED SYMBOLS
                            *ABS*:00000000 utils.c
C:\Users\Jorge\AppData\Local\Temp\ccGkgvxo.s:1782   .data:00000000 $d
C:\Users\Jorge\AppData\Local\Temp\ccGkgvxo.s:1785   .data:00000000 delayLoopCount
C:\Users\Jorge\AppData\Local\Temp\ccGkgvxo.s:1789   .text:00000000 $a
C:\Users\Jorge\AppData\Local\Temp\ccGkgvxo.s:1792   .text:00000000 Delay
C:\Users\Jorge\AppData\Local\Temp\ccGkgvxo.s:1904   .text:00000118 $d
C:\Users\Jorge\AppData\Local\Temp\ccGkgvxo.s:1915   .text:00000138 $a
C:\Users\Jorge\AppData\Local\Temp\ccGkgvxo.s:1918   .text:00000138 insertElementToQueue
                     .debug_frame:00000010 $d

UNDEFINED SYMBOLS
__aeabi_idiv
